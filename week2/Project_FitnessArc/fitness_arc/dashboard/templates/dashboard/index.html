{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<h1>ğŸ“Š Tableau de bord</h1>
<p style="color:var(--text-dim);margin-bottom:2rem">Vue d'ensemble de votre activitÃ© du {{ today|date:"l d M" }}</p>

<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem;margin-bottom:2rem">
  <div class="stat-card" style="background:linear-gradient(135deg,rgba(99,102,241,0.2),rgba(139,92,246,0.15));border:1px solid rgba(99,102,241,0.3)">
    <h3 style="margin:0 0 0.5rem;font-size:0.9rem;opacity:0.9;color:var(--text)">Calories ConsommÃ©es</h3>
    <p style="font-size:2.5rem;margin:0;font-weight:bold;color:var(--text)">{{ calories_consumed }}</p>
    <p style="margin:0.5rem 0 0;opacity:0.8;font-size:0.85rem;color:var(--text-dim)">ProtÃ©ines : {{ protein_consumed }}g</p>
  </div>
  
  <div class="stat-card" style="background:linear-gradient(135deg,rgba(239,68,68,0.2),rgba(220,38,38,0.15));border:1px solid rgba(239,68,68,0.3)">
    <h3 style="margin:0 0 0.5rem;font-size:0.9rem;opacity:0.9;color:var(--text)">Calories BrÃ»lÃ©es</h3>
    <p style="font-size:2.5rem;margin:0;font-weight:bold;color:var(--danger)">{{ calories_burned }}</p>
    <p style="margin:0.5rem 0 0;opacity:0.8;font-size:0.85rem;color:var(--text-dim)">SÃ©ances : {{ sessions_count }}</p>
  </div>
  
  {% if calorie_balance > 0 %}
  <div class="stat-card" style="background:linear-gradient(135deg,rgba(16,185,129,0.2),rgba(5,150,105,0.15));border:1px solid rgba(16,185,129,0.3)">
    <h3 style="margin:0 0 0.5rem;font-size:0.9rem;opacity:0.9;color:var(--text)">Balance Calorique</h3>
    <p style="font-size:2.5rem;margin:0;font-weight:bold;color:var(--success)">+{{ calorie_balance|floatformat:0 }}</p>
  {% elif calorie_balance < 0 %}
  <div class="stat-card" style="background:linear-gradient(135deg,rgba(245,158,11,0.2),rgba(217,119,6,0.15));border:1px solid rgba(245,158,11,0.3)">
    <h3 style="margin:0 0 0.5rem;font-size:0.9rem;opacity:0.9;color:var(--text)">Balance Calorique</h3>
    <p style="font-size:2.5rem;margin:0;font-weight:bold;color:var(--warning)">{{ calorie_balance|floatformat:0 }}</p>
  {% else %}
  <div class="stat-card" style="background:linear-gradient(135deg,rgba(99,102,241,0.2),rgba(139,92,246,0.15));border:1px solid rgba(99,102,241,0.3)">
    <h3 style="margin:0 0 0.5rem;font-size:0.9rem;opacity:0.9;color:var(--text)">Balance Calorique</h3>
    <p style="font-size:2.5rem;margin:0;font-weight:bold;color:var(--text)">{{ calorie_balance|floatformat:0 }}</p>
  {% endif %}
    <p style="margin:0.5rem 0 0;opacity:0.8;font-size:0.85rem;color:var(--text-dim)">
      {% if calorie_balance > 0 %}Surplus{% elif calorie_balance < 0 %}DÃ©ficit{% else %}Ã‰quilibre{% endif %}
    </p>
  </div>
  
  <div class="stat-card" style="background:linear-gradient(135deg,rgba(236,72,153,0.2),rgba(219,39,119,0.15));border:1px solid rgba(236,72,153,0.3)">
    <h3 style="margin:0 0 0.5rem;font-size:0.9rem;opacity:0.9;color:var(--text)">Volume (7 jours)</h3>
    <p style="font-size:2.5rem;margin:0;font-weight:bold;color:var(--accent)">{{ weekly_volume|floatformat:0 }}</p>
    <p style="margin:0.5rem 0 0;opacity:0.8;font-size:0.85rem;color:var(--text-dim)">kg Ã— reps</p>
  </div>
</div>

<div style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;margin-bottom:2rem">
  <div class="card">
    <h3>ğŸ‹ï¸ Raccourcis EntraÃ®nement</h3>
    <a href="{% url 'workouts:template_list' %}" class="btn" style="margin-top:1rem">Mes Workouts</a>
    <a href="{% url 'workouts:exercise_list' %}" class="btn" style="background:#6c757d;margin-left:0.5rem">Exercices</a>
  </div>
  
  <div class="card">
    <h3>ğŸ¥— Raccourcis Nutrition</h3>
    <a href="{% url 'nutrition_today' %}" class="btn" style="margin-top:1rem">Journal du jour</a>
  </div>
</div>

{% if workout_history %}
<div class="card" style="margin-bottom:1.5rem">
  <h3>ğŸ“… Historique des Workouts (30 derniers jours)</h3>
  {% for item in workout_history %}
  <div style="border:1px solid #e5e7eb;border-radius:8px;padding:1rem;margin:1rem 0;background:#f9fafb">
    <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:0.5rem">
      <div>
        <h4 style="margin:0;color:#111">
          {% if item.session.from_template %}
            {{ item.session.from_template.name }}
          {% else %}
            SÃ©ance du {{ item.session.date|date:"d/m/Y" }}
          {% endif %}
        </h4>
        <p style="color:#666;font-size:0.9rem;margin:0.25rem 0">
          {{ item.session.date|date:"l d M Y" }} â€¢ {{ item.session.duration_minutes }} min
        </p>
      </div>
      <div style="text-align:right">
        <span style="background:#667eea;color:#fff;padding:4px 8px;border-radius:6px;font-size:0.85rem">
          ğŸ”¥ {{ item.session.estimated_calories_burned }} kcal
        </span>
      </div>
    </div>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:0.5rem;margin:0.75rem 0">
      {% for ex_name, data in item.exercises.items %}
      <div style="background:#fff;padding:0.5rem;border-radius:6px;font-size:0.85rem">
        <strong>{{ ex_name }}</strong><br>
        <span style="color:#666">{{ data.sets }} sÃ©ries â€¢ {{ data.reps }} reps</span>
      </div>
      {% endfor %}
    </div>
    
    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:0.75rem;padding-top:0.75rem;border-top:1px solid #e5e7eb">
      <div style="font-size:0.9rem;color:#666">
        ğŸ“Š Volume total: <strong>{{ item.session.total_volume|floatformat:0 }} kg</strong> â€¢ 
        SÃ©ries: <strong>{{ item.total_sets }}</strong>
        {% if item.prs_count > 0 %}
        â€¢ ğŸ† <strong style="color:#f59e0b">{{ item.prs_count }} nouveau(x) PR(s)</strong>
        {% endif %}
      </div>
      <a href="{% url 'workouts:session_summary' item.session.pk %}" class="btn" style="padding:4px 12px;font-size:0.85rem">
        Voir dÃ©tails â†’
      </a>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<div class="card" style="margin-bottom:1.5rem;text-align:center;padding:2rem">
  <p style="color:#666">Aucun workout complÃ©tÃ© rÃ©cemment.</p>
  <a href="{% url 'workouts:template_list' %}" class="btn" style="margin-top:1rem">Commencer un workout â†’</a>
</div>
{% endif %}

{% if recent_prs %}
<div class="card" style="margin-top:1.5rem">
  <h3>ğŸ† Records RÃ©cents (PRs)</h3>
  <table>
    <thead><tr><th>Date</th><th>Exercice</th><th>Type</th><th>Valeur</th></tr></thead>
    <tbody>
      {% for pr in recent_prs %}
      <tr>
        <td>{{ pr.date|date:"d/m/Y" }}</td>
        <td>{{ pr.exercise.name }}</td>
        <td>{{ pr.get_metric_display }}</td>
        <td><strong>{{ pr.value }} kg</strong></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}
{% endblock %}
