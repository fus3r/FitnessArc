{% extends 'base.html' %}
{% load static %}

{% block title %}{{ recipe.name }} - Recettes - FitnessArc{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'recipe_list' %}">Recettes</a></li>
                    <li class="breadcrumb-item active">{{ recipe.name }}</li>
                </ol>
            </nav>
        </div>
    </div>

    <div class="row">
        <!-- Image et informations générales -->
        <div class="col-lg-5 mb-4">
            {% if recipe.image_url %}
            <img src="{{ recipe.image_url }}" class="img-fluid rounded shadow-sm mb-3" alt="{{ recipe.name }}">
            {% else %}
            <div class="bg-light rounded d-flex align-items-center justify-content-center shadow-sm mb-3" style="height: 300px;">
                <i class="bi bi-image text-muted" style="font-size: 5rem;"></i>
            </div>
            {% endif %}

            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title mb-3">Informations</h5>
                    
                    <div class="d-flex justify-content-between mb-2">
                        <span><i class="bi bi-clock"></i> Préparation:</span>
                        <strong>{{ recipe.prep_time_minutes }} min</strong>
                    </div>
                    
                    <div class="d-flex justify-content-between mb-2">
                        <span><i class="bi bi-fire"></i> Cuisson:</span>
                        <strong>{{ recipe.cook_time_minutes }} min</strong>
                    </div>
                    
                    <div class="d-flex justify-content-between mb-2">
                        <span><i class="bi bi-hourglass-split"></i> Temps total:</span>
                        <strong>{{ recipe.total_time_minutes }} min</strong>
                    </div>
                    
                    <hr>
                    
                    <div class="d-flex justify-content-between mb-2">
                        <span><i class="bi bi-people"></i> Portions:</span>
                        <strong>{{ recipe.servings }}</strong>
                    </div>
                    
                    <div class="d-flex justify-content-between mb-2">
                        <span><i class="bi bi-speedometer2"></i> Difficulté:</span>
                        <span class="badge bg-secondary">{{ recipe.get_difficulty_display }}</span>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <span><i class="bi bi-egg-fried"></i> Type:</span>
                        <span class="badge bg-primary">{{ recipe.get_meal_type_display }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contenu principal -->
        <div class="col-lg-7">
            <h1 class="mb-3">{{ recipe.name }}</h1>
            
            {% if recipe.description %}
            <p class="lead text-muted mb-4">{{ recipe.description }}</p>
            {% endif %}

            <!-- Valeurs nutritionnelles -->
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-heart-pulse"></i> Valeurs Nutritionnelles</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-6 col-md-3 mb-3">
                            <div class="border rounded p-3">
                                <h4 class="text-success mb-0">{{ nutrition_info.per_serving.kcal|floatformat:0 }}</h4>
                                <small class="text-muted">Calories</small>
                            </div>
                        </div>
                        <div class="col-6 col-md-3 mb-3">
                            <div class="border rounded p-3">
                                <h4 class="text-danger mb-0">{{ nutrition_info.per_serving.protein|floatformat:0 }}g</h4>
                                <small class="text-muted">Protéines</small>
                            </div>
                        </div>
                        <div class="col-6 col-md-3 mb-3">
                            <div class="border rounded p-3">
                                <h4 class="text-warning mb-0">{{ nutrition_info.per_serving.carbs|floatformat:0 }}g</h4>
                                <small class="text-muted">Glucides</small>
                            </div>
                        </div>
                        <div class="col-6 col-md-3 mb-3">
                            <div class="border rounded p-3">
                                <h4 class="text-info mb-0">{{ nutrition_info.per_serving.fat|floatformat:0 }}g</h4>
                                <small class="text-muted">Lipides</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info mb-0">
                        <small><i class="bi bi-info-circle"></i> Valeurs par portion ({{ recipe.servings }} portion{{ recipe.servings|pluralize }})</small>
                    </div>
                </div>
            </div>

            <!-- Ingrédients -->
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-cart"></i> Ingrédients</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        {% for ingredient in ingredients %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>
                                <strong>{{ ingredient.food.name }}</strong>
                                {% if ingredient.notes %}
                                <small class="text-muted">({{ ingredient.notes }})</small>
                                {% endif %}
                            </span>
                            <span class="badge bg-secondary">
                                {{ ingredient.quantity }} {{ ingredient.food.get_unit_label }}
                            </span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <!-- Instructions -->
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-warning">
                    <h5 class="mb-0"><i class="bi bi-list-ol"></i> Préparation</h5>
                </div>
                <div class="card-body">
                    <div class="recipe-instructions">
                        {{ recipe.instructions|linebreaks }}
                    </div>
                </div>
            </div>

            <!-- Valeurs totales -->
            <div class="card shadow-sm">
                <div class="card-body">
                    <h6 class="text-muted mb-3">Valeurs nutritionnelles totales (recette complète)</h6>
                    <div class="row text-center">
                        <div class="col-3">
                            <small class="text-muted d-block">Calories</small>
                            <strong>{{ nutrition_info.total.kcal|floatformat:0 }}</strong>
                        </div>
                        <div class="col-3">
                            <small class="text-muted d-block">Protéines</small>
                            <strong>{{ nutrition_info.total.protein|floatformat:0 }}g</strong>
                        </div>
                        <div class="col-3">
                            <small class="text-muted d-block">Glucides</small>
                            <strong>{{ nutrition_info.total.carbs|floatformat:0 }}g</strong>
                        </div>
                        <div class="col-3">
                            <small class="text-muted d-block">Lipides</small>
                            <strong>{{ nutrition_info.total.fat|floatformat:0 }}g</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bouton retour -->
    <div class="row mt-4">
        <div class="col-12">
            <a href="{% url 'recipe_list' %}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Retour aux recettes
            </a>
        </div>
    </div>
</div>

<style>
.recipe-instructions {
    white-space: pre-wrap;
    line-height: 1.8;
}
</style>
{% endblock %}
